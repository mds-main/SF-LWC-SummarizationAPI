# Genesys Cloud Copilot Summary & Wrap-up LWC for Salesforce

**Disclaimer: This code is intended for research and demonstration purposes. It requires testing before being considered for use in a production environment. Ensure all security, error handling, and scalability aspects are thoroughly reviewed and addressed according to your organization's standards.**

## Overview

This Salesforce Lightning Web Component (LWC) provides a user interface to display interaction summaries and suggested wrap-up codes generated by Genesys Cloud Copilot. It allows users to view details of an interaction, including a summary, resolution, reason, and follow-up actions. Additionally, it presents up to three AI-suggested wrap-up codes with confidence scores, enabling users to apply a selected wrap-up code directly from the Salesforce interface.

This repository contains two similar components:
1. **`genesysExperienceSummary`** - Designed for the custom `genesysps__Experience__c` object
2. **`genesysVoiceCallSummary`** - Designed for the standard `VoiceCall` object

Both components are designed to be placed on Salesforce record pages for their respective objects.

## Features

* **Interaction Details Display**: Shows key information from Genesys Cloud Copilot:
    * Interaction/Call Summary
    * Resolution
    * Reason
    * Follow-up Actions
* **Wrap-up Code Suggestions**: Displays up to three wrap-up codes (Primary, Secondary, Tertiary) suggested by Genesys Cloud Copilot.
* **Confidence Visualization**: Each suggested wrap-up code and summary section is visually styled (border color) based on its confidence score, providing an intuitive understanding of the AI's certainty.
    * **Low Confidence (e.g., <= 40%)**: Red border
    * **Medium Confidence (e.g., 40-80%)**: Yellow/Orange border (interpolated)
    * **High Confidence (e.g., >= 80%)**: Green border
* **One-Click Wrap-up Application**: Users can click on a suggested wrap-up code to apply it to the corresponding Genesys Cloud interaction.
* **Asynchronous Operations**: Wrap-up code updates are made via an asynchronous callout (`@future` method) to the Genesys Cloud API to prevent UI blocking.
* **User Feedback**:
    * Visual cues (e.g., "Click to apply" indicator, processing animation) enhance user experience.
    * Toast notifications inform the user about the success or failure of operations.
* **Responsive Design**: Includes styling for different screen sizes (e.g., adjustments for viewports <= 768px).
* **Custom Styling**: Utilizes custom CSS for a modern and integrated look and feel within Salesforce Lightning Experience.
* **Multi-Object Support**: Components available for both custom (`genesysps__Experience__c`) and standard (`VoiceCall`) objects.

## Technical Overview

### Architecture

The solution consists of Lightning Web Components and an Apex controller:

1.  **`genesysExperienceSummary` LWC** (for `genesysps__Experience__c`):
    * **HTML (`genesysExperienceSummary.html`)**: Defines the structure and layout of the component, including sections for interaction details and wrap-up codes.
    * **JavaScript (`genesysExperienceSummary.js`)**: Handles client-side logic, retrieves record data using `lightning/uiRecordApi`, processes user interactions (e.g., clicking a wrap-up code), and calls the Apex controller.
    * **CSS (`genesysExperienceSummary.css`)**: Provides custom styling for the component, including confidence-based border colors and hover effects.
    * **Metadata (`genesysExperienceSummary.js-meta.xml`)**: Defines that the component is exposed and can be used on Lightning Record Pages for the `genesysps__Experience__c` object.

2.  **`genesysVoiceCallSummary` LWC** (for `VoiceCall`):
    * **HTML (`genesysVoiceCallSummary.html`)**: Defines the structure and layout of the component, including sections for call details and wrap-up codes.
    * **JavaScript (`genesysVoiceCallSummary.js`)**: Handles client-side logic, retrieves record data using `lightning/uiRecordApi`, processes user interactions (e.g., clicking a wrap-up code), and calls the Apex controller.
    * **CSS (`genesysVoiceCallSummary.css`)**: Provides custom styling for the component, including confidence-based border colors and hover effects.
    * **Metadata (`genesysVoiceCallSummary.js-meta.xml`)**: Defines that the component is exposed and can be used on Lightning Record Pages for the `VoiceCall` object.

3.  **Apex Controller Classes**:
    * **`ExperienceCopilotController`**: Handles wrap-up code updates for the `genesysps__Experience__c` object
        - **`updateWrapUpCode` method**: An `@AuraEnabled` method called by the Experience LWC to initiate the wrap-up code update process
        - **`futureCallout` method**: A `@future(callout=true)` method that performs the HTTP POST request to the Genesys Cloud API
        - **`FlowInputs` inner class**: Defines the structure for the JSON payload sent to the Genesys Cloud API
        - **`WrapUpException` inner class**: Custom exception class for handling errors related to wrap-up operations
    * **`VoiceCallCopilotController`**: Handles wrap-up code updates for the `VoiceCall` object
        - **`updateWrapUpCode` method**: An `@AuraEnabled` method called by the VoiceCall LWC to initiate the wrap-up code update process
        - **`futureCallout` method**: A `@future(callout=true)` method that performs the HTTP POST request to the Genesys Cloud API
        - **`FlowInputs` inner class**: Defines the structure for the JSON payload sent to the Genesys Cloud API
        - **`WrapUpException` inner class**: Custom exception class for handling errors related to wrap-up operations

### Key Components and Logic

* **Data Retrieval**: Both LWCs use the `@wire` service with `getRecord` to fetch data from their respective objects (`genesysps__Experience__c` or `VoiceCall`). They retrieve various fields related to Copilot summaries, confidence scores, wrap-up codes, and interaction identifiers.
* **Confidence Styling**: The JavaScript controller includes a `getConfidenceColor` function that calculates an RGB color based on a confidence value (0-1). This color is then used to dynamically style the borders of the text areas displaying summaries and wrap-up codes.
* **Wrap-up Code Application**:
    1.  When a user clicks on a wrap-up code box, the `handleWrapUpClick` JavaScript function is triggered.
    2.  It retrieves the `interactionId`, the selected `wrapUpCodeId`, `participantId` (specifically `GC_agent_participant_id__c`), and `communicationId` from the current record's data.
    3.  It calls the `updateWrapUpCode` Apex method.
    4.  The Apex method constructs the JSON payload and the API endpoint.
    5.  The `futureCallout` Apex method then makes an HTTP POST request to `callout:GC_Base_API/api/v2/conversations/calls/{interactionId}/participants/{participantId}/communications/{communicationId}/wrapup`.
* **Named Credential**: The Apex callout uses a Named Credential `GC_Base_API`. This must be configured in Salesforce with the base URL for the Genesys Cloud API.
* **Error Handling**: Both LWCs and the Apex controller include error handling. The LWCs display toast notifications for errors, and the Apex controller logs errors and throws `AuraHandledException` or custom `WrapUpException`.

## Setup and Prerequisites

1.  **Deploy Components**:
    * Deploy the Apex controller classes:
        - `ExperienceCopilotController.cls` (for `genesysps__Experience__c` object)
        - `VoiceCallCopilotController.cls` (for `VoiceCall` object)
    * Deploy both LWC bundles:
        - `genesysExperienceSummary` (HTML, JS, CSS, XML) for the `genesysps__Experience__c` object
        - `genesysVoiceCallSummary` (HTML, JS, CSS, XML) for the `VoiceCall` object
2.  **Configure Named Credential**:
    * In Salesforce Setup, navigate to "Named Credentials".
    * Create or ensure a Named Credential named `GC_Base_API` exists.
    * Configure it with the appropriate Genesys Cloud API base URL (e.g., `https://api.mypurecloud.com` or region-specific URL) and authentication details (e.g., OAuth 2.0).
3.  **Custom Fields**:
    * **For `genesysps__Experience__c` object**: Ensure the custom object has the fields referenced in the LWC and Apex class.
    * **For `VoiceCall` object**: Ensure the standard object has the custom fields referenced in the LWC and Apex class.

The following fields are created for both objects:

| Label | API Name | Type | Applies To |
| :--- | :--- | :--- | :--- |
| GC Copilot Wrap-up 1 Name | `GC_Copilot_wrap_up_1_name__c` | Text | Both |
| GC Copilot Wrap-up 1 Confidence | `GC_Copilot_wrap_up_1_confidence__c` | Number (0-1) | Both |
| GC Copilot Wrap-up 1 ID | `GC_Copilot_wrap_up_1_id__c` | Text | Both |
| GC Copilot Wrap-up 2 Name | `GC_Copilot_wrap_up_2_name__c` | Text | Both |
| GC Copilot Wrap-up 2 Confidence | `GC_Copilot_wrap_up_2_confidence__c` | Number (0-1) | Both |
| GC Copilot Wrap-up 2 ID | `GC_Copilot_wrap_up_2_id__c` | Text | Both |
| GC Copilot Wrap-up 3 Name | `GC_Copilot_wrap_up_3_name__c` | Text | Both |
| GC Copilot Wrap-up 3 Confidence | `GC_Copilot_wrap_up_3_confidence__c` | Number (0-1) | Both |
| GC Copilot Wrap-up 3 ID | `GC_Copilot_wrap_up_3_id__c` | Text | Both |
| GC Copilot Summary Text | `GC_Copilot_summary_text__c` | Long Text Area | Both |
| GC Copilot Summary Confidence | `GC_Copilot_summary_confidence__c` | Number (0-1) | Both |
| GC Copilot Resolution Text | `GC_Copilot_resolution_text__c` | Long Text Area | Both |
| GC Copilot Resolution Confidence | `GC_Copilot_resolution_confidence__c` | Number (0-1) | Both |
| GC Copilot Reason Text | `GC_Copilot_reason_text__c` | Long Text Area | Both |
| GC Copilot Reason Confidence | `GC_Copilot_reason_confidence__c` | Number (0-1) | Both |
| GC Copilot Follow-up Text | `GC_Copilot_followup_text__c` | Long Text Area | Both |
| GC Copilot Follow-up Confidence | `GC_Copilot_followup_confidence__c` | Number (0-1) | Both |
| GC Copilot Participant ID | `GC_Copilot_participant_id__c` | Text | Both |
| GC Agent Participant ID | `GC_agent_participant_id__c` | Text | Both |
| GC Copilot Communication ID | `GC_Copilot_communication_id__c` | Text | Both |
| GC Interaction ID | `GC_Interaction_Id__c` | Text | VoiceCall only |
| Interaction ID | `genesysps__Interaction_Id__c` | Text | Experience only |

**Note**: For the `VoiceCall` object, all fields are custom fields that need to be created. For the `genesysps__Experience__c` object, some fields may already exist (like `genesysps__Interaction_Id__c`), but the GC_Copilot fields are custom fields that need to be created.
4.  **Permissions**:
    * Ensure users have permission to access both Apex controller classes:
        - `ExperienceCopilotController` (for `genesysps__Experience__c` object)
        - `VoiceCallCopilotController` (for `VoiceCall` object)
    * Ensure users have read access to the fields on both the `genesysps__Experience__c` and `VoiceCall` objects.

## Deployment

### Deploying via Salesforce CLI

To deploy this solution to your Salesforce org using the Salesforce CLI, use the following command:

```bash
sf project deploy start -d force-app/main/default -o <username>
```

Replace `<username>` with your Salesforce username or alias.

**Prerequisites for CLI Deployment:**
- Install the Salesforce CLI
- Authenticate with your target org using `sf org login web`
- Ensure all components are properly structured in the `force-app/main/default` directory

### Production Deployment Requirements

**Important:** For production org deployment, you must create test classes for both Apex controllers:

- **`ExperienceCopilotController`**: Requires test class with minimum 75% code coverage
- **`VoiceCallCopilotController`**: Requires test class with minimum 75% code coverage

**Test Class Requirements:**
- Test the `updateWrapUpCode` method with various scenarios
- Mock HTTP callouts using `HttpCalloutMock` (since these are `@future` methods)
- Test error handling scenarios
- Achieve at least 75% code coverage for production deployment

**Example Test Structure:**
```apex
@isTest
private class ExperienceCopilotControllerTest {
    @isTest static void testUpdateWrapUpCode() {
        // Test implementation here
    }

    @isTest static void testErrorHandling() {
        // Test error scenarios
    }
}
```

## How to Use

### For genesysps__Experience__c records:
1.  Navigate to the Lightning App Builder for the `genesysps__Experience__c` record page.
2.  Drag the `genesysExperienceSummary` LWC from the custom components panel onto the page layout.
3.  The component will automatically use the `recordId` of the page it's placed on.
4.  Save and activate the page.

### For VoiceCall records:
1.  Navigate to the Lightning App Builder for the `VoiceCall` record page.
2.  Drag the `genesysVoiceCallSummary` LWC from the custom components panel onto the page layout.
3.  The component will automatically use the `recordId` of the page it's placed on.
4.  Save and activate the page.

When viewing a record, the respective component will display the Copilot summary and wrap-up codes if the corresponding fields are populated on the record. Users can then click a wrap-up code to apply it.

## Key Files

### Apex Controller Classes
* **`ExperienceCopilotController.cls`**:
    * Handles the server-side logic for updating the wrap-up code via a callout to the Genesys Cloud API for `genesysps__Experience__c` records.
    * Uses `@AuraEnabled` for methods callable from the Experience LWC and `@future(callout=true)` for asynchronous API calls.
* **`VoiceCallCopilotController.cls`**:
    * Handles the server-side logic for updating the wrap-up code via a callout to the Genesys Cloud API for `VoiceCall` records.
    * Uses `@AuraEnabled` for methods callable from the VoiceCall LWC and `@future(callout=true)` for asynchronous API calls.

### genesysExperienceSummary Component (for genesysps__Experience__c)
* **`genesysExperienceSummary.html`**:
    * The template file defining the LWC's structure.
    * Uses `lightning-icon` for visual elements and standard SLDS (Salesforce Lightning Design System) classes for layout.
    * Displays data dynamically using bound JavaScript properties (e.g., `{summary}`, `{wrapUp1}`).
* **`genesysExperienceSummary.js`**:
    * The client-side controller for the LWC.
    * Uses `@api recordId` to get the current record's ID.
    * Wires to `getRecord` to fetch data from `genesysps__Experience__c`.
    * Contains getters to extract field values (e.g., `get summary()`, `get wrapUp1()`).
    * Implements `getConfidenceColor` and `generateStyle` to dynamically style elements based on confidence scores.
    * Handles the `handleWrapUpClick` event to call the Apex method `updateWrapUpCode`.
    * Uses `ShowToastEvent` to display notifications.
* **`genesysExperienceSummary.css`**:
    * Contains all custom styles for the component, including card layout, icon styling, summary box appearance, confidence-based borders, and responsive adjustments.
* **`genesysExperienceSummary.js-meta.xml`**:
    * Configuration file for the LWC.
    * Sets `isExposed` to `true` and targets `lightning__RecordPage` for the `genesysps__Experience__c` object.

### genesysVoiceCallSummary Component (for VoiceCall)
* **`genesysVoiceCallSummary.html`**:
    * The template file defining the LWC's structure (similar to genesysExperienceSummary but adapted for VoiceCall).
    * Uses `lightning-icon` with "voice_call" icon for visual elements.
    * Displays data dynamically using bound JavaScript properties.
* **`genesysVoiceCallSummary.js`**:
    * The client-side controller for the LWC.
    * Uses `@api recordId` to get the current record's ID.
    * Wires to `getRecord` to fetch data from `VoiceCall`.
    * Contains getters to extract field values from VoiceCall fields.
    * Implements `getConfidenceColor` and `generateStyle` to dynamically style elements based on confidence scores.
    * Handles the `handleWrapUpClick` event to call the Apex method `updateWrapUpCode`.
    * Uses `ShowToastEvent` to display notifications.
* **`genesysVoiceCallSummary.css`**:
    * Contains all custom styles for the component (identical to genesysExperienceSummary.css).
* **`genesysVoiceCallSummary.js-meta.xml`**:
    * Configuration file for the LWC.
    * Sets `isExposed` to `true` and targets `lightning__RecordPage` for the `VoiceCall` object.

## Error Handling and Logging

* **Apex**: Both `ExperienceCopilotController` and `VoiceCallCopilotController` use `try-catch` blocks to handle exceptions. Errors are logged using `System.debug` and re-thrown as `AuraHandledException` or custom `WrapUpException` to be caught by their respective LWCs.
* **LWC**: Both `genesysExperienceSummary.js` and `genesysVoiceCallSummary.js` files include error handling for data loading (`wiredExperience`/`wiredVoiceCall`) and for the wrap-up update process (`handleWrapUpClick`). Errors are displayed to the user via `ShowToastEvent`.
* **Debugging**: Console logs (`System.debug` in Apex, `console.log` and `console.error` in JS) are present throughout the code to aid in debugging. The `DEBUG_HEADER` constants help identify the source of log messages.
