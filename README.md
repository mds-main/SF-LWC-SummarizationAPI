# Genesys Cloud Copilot Summary & Wrap-up LWC for Salesforce

**Disclaimer: This code is intended for research and demonstration purposes. It requires testing before being considered for use in a production environment. Ensure all security, error handling, and scalability aspects are thoroughly reviewed and addressed according to your organization's standards.**

## Overview

This Salesforce Lightning Web Component (LWC) provides a user interface to display interaction summaries and suggested wrap-up codes generated by Genesys Cloud Copilot. It allows users to view details of an interaction, including a summary, resolution, reason, and follow-up actions. Additionally, it presents up to three AI-suggested wrap-up codes with confidence scores, enabling users to apply a selected wrap-up code directly from the Salesforce interface.

This repository contains two similar components:
1. **`genesysExperienceSummary`** - Designed for the custom `genesysps__Experience__c` object
2. **`genesysVoiceCallSummary`** - Designed for the standard `VoiceCall` object

Both components are designed to be placed on Salesforce record pages for their respective objects.

## Features

* **Interaction Details Display**: Shows key information from Genesys Cloud Copilot:
    * **Editable Interaction/Call Summary** (auto-saves after 2 seconds of inactivity)
    * Resolution
    * Reason
    * Follow-up Actions
* **Wrap-up Code Suggestions**: Displays up to three wrap-up codes (Primary, Secondary, Tertiary) suggested by Genesys Cloud Copilot.
* **Confidence Visualization**: Each suggested wrap-up code and summary section is visually styled (border color) based on its confidence score, providing an intuitive understanding of the AI's certainty.
    * **Low Confidence (e.g., <= 40%)**: Red border
    * **Medium Confidence (e.g., 40-80%)**: Yellow/Orange border (interpolated)
    * **High Confidence (e.g., >= 80%)**: Green border
* **One-Click Wrap-up Application**: Users can click on a suggested wrap-up code to apply it to the corresponding Genesys Cloud interaction.
* **Asynchronous Operations**: Wrap-up code updates are made via an asynchronous callout (`@future` method) to the Genesys Cloud API to prevent UI blocking.
* **User Feedback**:
    * Visual cues (e.g., "Click to apply" indicator, processing animation) enhance user experience.
    * Toast notifications inform the user about the success or failure of operations.
* **Responsive Design**: Includes styling for different screen sizes (e.g., adjustments for viewports <= 768px).
* **Custom Styling**: Utilizes custom CSS for a modern and integrated look and feel within Salesforce Lightning Experience.
* **Multi-Object Support**: Components available for both custom (`genesysps__Experience__c`) and standard (`VoiceCall`) objects.

## Technical Overview

### Architecture

The solution consists of Lightning Web Components, Apex controllers, automation triggers, and data fetching classes:

1.  **`genesysExperienceSummary` LWC** (for `genesysps__Experience__c`):
    * **HTML (`genesysExperienceSummary.html`)**: Defines the structure and layout of the component, including sections for interaction details and wrap-up codes.
    * **JavaScript (`genesysExperienceSummary.js`)**: Handles client-side logic, retrieves record data using `lightning/uiRecordApi`, processes user interactions (e.g., clicking a wrap-up code), and calls the Apex controller.
    * **CSS (`genesysExperienceSummary.css`)**: Provides custom styling for the component, including confidence-based border colors and hover effects.
    * **Metadata (`genesysExperienceSummary.js-meta.xml`)**: Defines that the component is exposed and can be used on Lightning Record Pages for the `genesysps__Experience__c` object.

2.  **`genesysVoiceCallSummary` LWC** (for `VoiceCall`):
    * **HTML (`genesysVoiceCallSummary.html`)**: Defines the structure and layout of the component, including sections for call details and wrap-up codes.
    * **JavaScript (`genesysVoiceCallSummary.js`)**: Handles client-side logic, retrieves record data using `lightning/uiRecordApi`, processes user interactions (e.g., clicking a wrap-up code), and calls the Apex controller.
    * **CSS (`genesysVoiceCallSummary.css`)**: Provides custom styling for the component, including confidence-based border colors and hover effects.
    * **Metadata (`genesysVoiceCallSummary.js-meta.xml`)**: Defines that the component is exposed and can be used on Lightning Record Pages for the `VoiceCall` object.

3.  **Apex Controller Classes**:
    * **`ExperienceCopilotController`**: Handles wrap-up code updates for the `genesysps__Experience__c` object
        - **`updateWrapUpCode` method**: An `@AuraEnabled` method called by the Experience LWC to initiate the wrap-up code update process
        - **`futureCallout` method**: A `@future(callout=true)` method that performs the HTTP POST request to the Genesys Cloud API
        - **`FlowInputs` inner class**: Defines the structure for the JSON payload sent to the Genesys Cloud API
        - **`WrapUpException` inner class**: Custom exception class for handling errors related to wrap-up operations
    * **`VoiceCallCopilotController`**: Handles wrap-up code updates for the `VoiceCall` object
        - **`updateWrapUpCode` method**: An `@AuraEnabled` method called by the VoiceCall LWC to initiate the wrap-up code update process
        - **`futureCallout` method**: A `@future(callout=true)` method that performs the HTTP POST request to the Genesys Cloud API
        - **`FlowInputs` inner class**: Defines the structure for the JSON payload sent to the Genesys Cloud API
        - **`WrapUpException` inner class**: Custom exception class for handling errors related to wrap-up operations

4.  **Data Fetching Classes** (Reusable for both objects):
    * **`GCGetAgentParticipantId`**: Fetches agent participant ID from Genesys Cloud Analytics API
        - **`getAgentParticipantId` method**: An `@InvocableMethod` that triggers the async data fetch
        - **`futureCallout` method**: Performs the HTTP GET request to `/api/v2/analytics/conversations/{id}/details`
        - **`extractAgentParticipantId` method**: Parses the response to find the agent participant ID
        - **`updateRecords` method**: Updates the relevant record(s) with the fetched agent participant ID
    * **`GCFetchInteractionSummary`**: Fetches Copilot summaries and wrap-up codes from Genesys Cloud with intelligent timing and validation
        - **`updateInteractionSummary` method**: An `@InvocableMethod` that triggers the async data fetch
        - **`futureCallout` method**: Performs the HTTP GET request to `/api/v2/conversations/{id}/summaries` with retry logic and timing delays
        - **`processResponse` method**: Parses and maps the response data to Salesforce fields, ensuring only complete session summaries with participants are accepted
        - **`updateRecord` method**: Updates the relevant record(s) with the fetched Copilot data
        - **Intelligent Retry Logic**: Implements configurable delays (1-second for Experience records, 2-seconds for VoiceCall records), handles 404 "No summaries found" errors with automatic retries, and validates session summaries have participants before accepting

5.  **Automation Triggers**:
    * **`ExperienceTrigger`**: Triggers data fetching for `genesysps__Experience__c` records
        - **After Insert**: Fetches agent participant ID when `genesysps__Interaction_Id__c` is populated and `GC_agent_participant_id__c` is blank (prevents duplicates)
        - **After Update**: Fetches Copilot summary when `genesysps__Ended__c` field transitions from null to populated, `genesysps__Interaction_Id__c` exists, and no Copilot summary/session ID exists yet (prevents loops and duplicates)
    * **`VoiceCallTrigger`**: Triggers data fetching for `VoiceCall` records
        - **After Insert**: Fetches agent participant ID when `GC_Interaction_Id__c` is populated and `GC_agent_participant_id__c` is blank (prevents duplicates)
        - **After Update**: Fetches Copilot summary when `CallDurationInSeconds` transitions from null/0 to > 0, `GC_Interaction_Id__c` exists, and no Copilot summary/session ID exists yet (prevents loops and duplicates)

### Key Components and Logic

* **Data Population (Automated)**: Triggers automatically fetch and populate Copilot data from Genesys Cloud APIs when records are created or updated:
    - **ExperienceTrigger**: On insert with `genesysps__Interaction_Id__c` and blank `GC_agent_participant_id__c` → fetches agent participant ID; on update when `genesysps__Ended__c` transitions from null to populated, with valid interaction ID and no existing Copilot summary → fetches Copilot summary
    - **VoiceCallTrigger**: On insert with `GC_Interaction_Id__c` and blank `GC_agent_participant_id__c` → fetches agent participant ID; on update when `CallDurationInSeconds` transitions from null/0 to > 0, with valid interaction ID and no existing Copilot summary → fetches Copilot summary
    - **GCGetAgentParticipantId**: Makes async callout to `/api/v2/analytics/conversations/{id}/details` to extract agent participant ID
    - **GCFetchInteractionSummary**: Makes async callout to `/api/v2/conversations/{id}/summaries` to fetch Copilot data and map to Salesforce fields with intelligent retry logic and timing

* **Intelligent Retry & Timing Logic**: The `GCFetchInteractionSummary` class implements sophisticated retry logic to ensure complete data retrieval:
    - **Initial Delay**: 1-second wait before the first API call to allow Genesys Cloud time to fully populate session summaries (2 seconds for VoiceCall records)
    - **Inter-Retry Delay**: 1-second wait between retry attempts (up to 3 total attempts) - 2 seconds for VoiceCall records
    - **404 Error Handling**: Automatically retries when receiving "No summaries found in DB for this hashkey" errors
    - **Participants Validation**: Only accepts session summaries that include a non-empty `participants` array, ensuring we get the complete, latest interaction data
    - **Last Non-Empty Selection**: Always selects the last (most recent) non-empty session summary with participants, not the first one

* **Data Retrieval**: Both LWCs use the `@wire` service with `getRecord` to fetch data from their respective objects (`genesysps__Experience__c` or `VoiceCall`). They retrieve various fields related to Copilot summaries, confidence scores, wrap-up codes, and interaction identifiers.

* **Confidence Styling**: The JavaScript controller includes a `getConfidenceColor` function that calculates an RGB color based on a confidence value (0-1). This color is then used to dynamically style the borders of the text areas displaying summaries and wrap-up codes.

* **Wrap-up Code Application**:
    1.  When a user clicks on a wrap-up code box, the `handleWrapUpClick` JavaScript function is triggered.
    2.  It retrieves the `interactionId`, the selected `wrapUpCodeId`, `participantId` (specifically `GC_agent_participant_id__c`), and `communicationId` from the current record's data.
    3.  It calls the `updateWrapUpCode` Apex method.
    4.  The Apex method constructs the JSON payload and the API endpoint.
    5.  The `futureCallout` Apex method then makes an HTTP POST request to `callout:GC_Base_API/api/v2/conversations/calls/{interactionId}/participants/{participantId}/communications/{communicationId}/wrapup`.

* **Named Credential**: The Apex callouts use a Named Credential `GC_Base_API`. This must be configured in Salesforce with the base URL for the Genesys Cloud API.

* **Error Handling**: All components include comprehensive error handling. The LWCs display toast notifications for errors, and the Apex classes log errors and throw appropriate exceptions.

## Setup and Prerequisites

1.  **Deploy Components**:
    * Deploy the Apex controller classes:
        - `ExperienceCopilotController.cls` (for `genesysps__Experience__c` object)
        - `VoiceCallCopilotController.cls` (for `VoiceCall` object)
    * Deploy the data fetching classes:
        - `GCGetAgentParticipantId.cls` (reusable for both objects)
        - `GCFetchInteractionSummary.cls` (reusable for both objects)
    * Deploy the automation triggers:
        - `ExperienceTrigger.trigger` (for `genesysps__Experience__c` object)
        - `VoiceCallTrigger.trigger` (for `VoiceCall` object)
    * Deploy both LWC bundles:
        - `genesysExperienceSummary` (HTML, JS, CSS, XML) for the `genesysps__Experience__c` object
        - `genesysVoiceCallSummary` (HTML, JS, CSS, XML) for the `VoiceCall` object
2.  **Configure Named Credential**:
    * In Salesforce Setup, navigate to "Named Credentials".
    * Create or ensure a Named Credential named `GC_Base_API` exists.
    * Configure it with the appropriate Genesys Cloud API base URL (e.g., `https://api.mypurecloud.com` or region-specific URL) and authentication details (e.g., OAuth 2.0).
3.  **Custom Fields**:
    * **For `genesysps__Experience__c` object**: Ensure the custom object has the fields referenced in the LWC and Apex class.
    * **For `VoiceCall` object**: Ensure the standard object has the custom fields referenced in the LWC and Apex class.

The following fields are created for both objects:

| Label | API Name | Type | Applies To |
| :--- | :--- | :--- | :--- |
| GC Copilot Wrap-up 1 Name | `GC_Copilot_wrap_up_1_name__c` | Text | Both |
| GC Copilot Wrap-up 1 Confidence | `GC_Copilot_wrap_up_1_confidence__c` | Number (0-1) | Both |
| GC Copilot Wrap-up 1 ID | `GC_Copilot_wrap_up_1_id__c` | Text | Both |
| GC Copilot Wrap-up 2 Name | `GC_Copilot_wrap_up_2_name__c` | Text | Both |
| GC Copilot Wrap-up 2 Confidence | `GC_Copilot_wrap_up_2_confidence__c` | Number (0-1) | Both |
| GC Copilot Wrap-up 2 ID | `GC_Copilot_wrap_up_2_id__c` | Text | Both |
| GC Copilot Wrap-up 3 Name | `GC_Copilot_wrap_up_3_name__c` | Text | Both |
| GC Copilot Wrap-up 3 Confidence | `GC_Copilot_wrap_up_3_confidence__c` | Number (0-1) | Both |
| GC Copilot Wrap-up 3 ID | `GC_Copilot_wrap_up_3_id__c` | Text | Both |
| GC Copilot Session Summary ID | `GC_Copilot_session_summary_id__c` | Text | Both |
| GC Copilot Summary Text | `GC_Copilot_summary_text__c` | Long Text Area | Both |
| GC Copilot Summary Confidence | `GC_Copilot_summary_confidence__c` | Number (0-1) | Both |
| GC Copilot Resolution Text | `GC_Copilot_resolution_text__c` | Long Text Area | Both |
| GC Copilot Resolution Confidence | `GC_Copilot_resolution_confidence__c` | Number (0-1) | Both |
| GC Copilot Reason Text | `GC_Copilot_reason_text__c` | Long Text Area | Both |
| GC Copilot Reason Confidence | `GC_Copilot_reason_confidence__c` | Number (0-1) | Both |
| GC Copilot Follow-up Text | `GC_Copilot_followup_text__c` | Long Text Area | Both |
| GC Copilot Follow-up Confidence | `GC_Copilot_followup_confidence__c` | Number (0-1) | Both |
| GC Copilot Participant ID | `GC_Copilot_participant_id__c` | Text | Both |
| GC Agent Participant ID | `GC_agent_participant_id__c` | Text | Both |
| GC Copilot Communication ID | `GC_Copilot_communication_id__c` | Text | Both |
| GC Interaction ID | `GC_Interaction_Id__c` | Text | VoiceCall only |
| Interaction ID | `genesysps__Interaction_Id__c` | Text | Experience only |

**Note**: For the `VoiceCall` object, all fields are custom fields that need to be created. For the `genesysps__Experience__c` object, some fields may already exist (like `genesysps__Interaction_Id__c`), but the GC_Copilot fields are custom fields that need to be created.
4.  **Permissions**:
    * Ensure users have permission to access all Apex classes:
        - `ExperienceCopilotController` (for `genesysps__Experience__c` object)
        - `VoiceCallCopilotController` (for `VoiceCall` object)
        - `GCGetAgentParticipantId` (reusable for both objects)
        - `GCFetchInteractionSummary` (reusable for both objects)
    * Ensure users have read access to the fields on both the `genesysps__Experience__c` and `VoiceCall` objects.
    * Ensure users have permission to execute the automation triggers.

## Deployment

### Deploying via Salesforce CLI

To deploy this solution to your Salesforce org using the Salesforce CLI, use the following command:

```bash
sf project deploy start -d force-app/main/default -o <username>
```

Replace `<username>` with your Salesforce username or alias.

**Prerequisites for CLI Deployment:**
- Install the Salesforce CLI
- Authenticate with your target org using `sf org login web`
- Ensure all components are properly structured in the `force-app/main/default` directory

### Production Deployment Requirements

**Important:** For production org deployment, you must create test classes for all Apex classes:

- **`ExperienceCopilotController`**: Requires test class with minimum 75% code coverage
- **`VoiceCallCopilotController`**: Requires test class with minimum 75% code coverage
- **`GCGetAgentParticipantId`**: Requires test class with minimum 75% code coverage
- **`GCFetchInteractionSummary`**: Requires test class with minimum 75% code coverage

**Test Class Requirements:**
- Test the `@AuraEnabled` and `@InvocableMethod` methods with various scenarios
- Mock HTTP callouts using `HttpCalloutMock` (since these are `@future` methods)
- Test error handling scenarios
- Test trigger automation logic
- Achieve at least 75% code coverage for production deployment

**Example Test Structure:**
```apex
@isTest
private class ExperienceCopilotControllerTest {
    @isTest static void testUpdateWrapUpCode() {
        // Test implementation here
    }

    @isTest static void testErrorHandling() {
        // Test error scenarios
    }
}
```

## How to Use

After completing the **Post-Deployment Configuration** steps below, the LWCs will automatically display Copilot data when records are created or updated with valid Genesys Cloud interaction IDs.

### User Experience

When viewing a record with populated Copilot data, users can:

- **View Copilot summaries and wrap-up codes** automatically populated by the async triggers
- **Edit the summary text** directly in the component (auto-saves after 2 seconds of inactivity, shows "Summary update sent" toast)
- **Click wrap-up codes** to apply them to the corresponding Genesys Cloud interaction
- **See real-time updates** via Change Data Capture (no manual refresh needed if CDC is enabled)

**Note:** Refer to the **Post-Deployment Configuration** section for setup instructions.

## Post-Deployment Configuration

After successfully deploying the components via Salesforce CLI, administrators must complete the following configuration steps in the Salesforce org:

### 1. Enable Change Data Capture (CDC)

**Required for automatic UI refresh functionality.**

1. Go to **Setup** → **Change Data Capture**
2. Click **Add Objects**
3. Select the following objects and enable them:
   - `genesysps__Experience__c` (Custom Object)
   - `VoiceCall` (Standard Object)
4. Click **Save**

**Why CDC is needed:** The LWCs subscribe to CDC events to automatically refresh when Copilot data is populated by the async triggers. Without CDC enabled, users must manually refresh the page to see updated data.

### 2. Add LWCs to Record Pages

**Required for users to access the Copilot summaries.**

#### For genesysps__Experience__c Records:
1. Go to **Setup** → **Lightning App Builder**
2. Find and edit the `genesysps__Experience__c` record page layout
3. Drag the `genesysExperienceSummary` component from the **Custom** components section onto the page
4. Configure the component (it automatically uses the record ID)
5. **Save** and **Activate** the page

#### For VoiceCall Records:
1. Go to **Setup** → **Lightning App Builder**
2. Find and edit the `VoiceCall` record page layout
3. Drag the `genesysVoiceCallSummary` component from the **Custom** components section onto the page
4. Configure the component (it automatically uses the record ID)
5. **Save** and **Activate** the page

### 3. Configure Field-Level Security (FLS) - Experience Object Only

**Required for users to access Copilot fields on Experience records.**

⚠️ **VoiceCall objects do not support Field-Level Security** - no configuration needed for VoiceCall records.

For `genesysps__Experience__c` records:

1. Go to **Setup** → **Profiles** (or **Permission Sets** if using them)
2. Select the profile(s) that will use the Experience LWC
3. Go to **Field-Level Security** → **genesysps__Experience__c**
4. Ensure **Read** access is enabled for the following fields:

   | Field API Name | Field Label | Required Access |
   |----------------|-------------|-----------------|
   | `GC_Copilot_session_summary_id__c` | GC Copilot Session Summary ID | ✅ Read |
   | `GC_Copilot_summary_text__c` | GC Copilot Summary Text | ✅ Read |
   | `GC_Copilot_summary_confidence__c` | GC Copilot Summary Confidence | ✅ Read |
   | `GC_Copilot_resolution_text__c` | GC Copilot Resolution Text | ✅ Read |
   | `GC_Copilot_resolution_confidence__c` | GC Copilot Resolution Confidence | ✅ Read |
   | `GC_Copilot_reason_text__c` | GC Copilot Reason Text | ✅ Read |
   | `GC_Copilot_reason_confidence__c` | GC Copilot Reason Confidence | ✅ Read |
   | `GC_Copilot_followup_text__c` | GC Copilot Follow-up Text | ✅ Read |
   | `GC_Copilot_followup_confidence__c` | GC Copilot Follow-up Confidence | ✅ Read |
   | `GC_Copilot_wrap_up_1_name__c` | GC Copilot Wrap-up 1 Name | ✅ Read |
   | `GC_Copilot_wrap_up_1_confidence__c` | GC Copilot Wrap-up 1 Confidence | ✅ Read |
   | `GC_Copilot_wrap_up_1_id__c` | GC Copilot Wrap-up 1 ID | ✅ Read |
   | `GC_Copilot_wrap_up_2_name__c` | GC Copilot Wrap-up 2 Name | ✅ Read |
   | `GC_Copilot_wrap_up_2_confidence__c` | GC Copilot Wrap-up 2 Confidence | ✅ Read |
   | `GC_Copilot_wrap_up_2_id__c` | GC Copilot Wrap-up 2 ID | ✅ Read |
   | `GC_Copilot_wrap_up_3_name__c` | GC Copilot Wrap-up 3 Name | ✅ Read |
   | `GC_Copilot_wrap_up_3_confidence__c` | GC Copilot Wrap-up 3 Confidence | ✅ Read |
   | `GC_Copilot_wrap_up_3_id__c` | GC Copilot Wrap-up 3 ID | ✅ Read |
   | `GC_Copilot_participant_id__c` | GC Copilot Participant ID | ✅ Read |
   | `GC_agent_participant_id__c` | GC Agent Participant ID | ✅ Read |
   | `GC_Copilot_communication_id__c` | GC Copilot Communication ID | ✅ Read |
   | `genesysps__Interaction_Id__c` | Interaction ID | ✅ Read |
   | `genesysps__Ended__c` | Ended | ✅ Read |

5. **Save** the profile changes

**Note:** If using Permission Sets instead of Profiles, apply the same field access to the relevant Permission Sets.

### 4. Verify Apex Class and Trigger Access

Ensure the following have proper access for the user profiles:

- ✅ **Apex Classes:** `ExperienceCopilotController`, `VoiceCallCopilotController`, `GCGetAgentParticipantId`, `GCFetchInteractionSummary`
- ✅ **Apex Triggers:** `ExperienceTrigger`, `VoiceCallTrigger`

### 5. Test the Integration

1. Create a test `genesysps__Experience__c` record with a valid `genesysps__Interaction_Id__c`
2. Wait for the trigger to populate Copilot data (may take a few minutes)
3. Verify the Experience LWC shows the Copilot summary and wrap-up codes
4. Test VoiceCall records similarly if applicable

**Important:** If CDC is not enabled or field permissions are missing, users will need to manually refresh the page to see updated Copilot data.

## Key Files

### Apex Controller Classes
* **`ExperienceCopilotController.cls`**:
    * Handles the server-side logic for updating the wrap-up code via a callout to the Genesys Cloud API for `genesysps__Experience__c` records.
    * Uses `@AuraEnabled` for methods callable from the Experience LWC and `@future(callout=true)` for asynchronous API calls.
* **`VoiceCallCopilotController.cls`**:
    * Handles the server-side logic for updating the wrap-up code via a callout to the Genesys Cloud API for `VoiceCall` records.
    * Uses `@AuraEnabled` for methods callable from the VoiceCall LWC and `@future(callout=true)` for asynchronous API calls.

### Data Fetching Classes (Reusable)
* **`GCGetAgentParticipantId.cls`**:
    * Fetches agent participant ID from Genesys Cloud Analytics API (`/api/v2/analytics/conversations/{id}/details`)
    * Uses `@InvocableMethod` for trigger-based invocation and `@future(callout=true)` for async processing
    * Extracts agent participant ID from API response and updates relevant records
* **`GCFetchInteractionSummary.cls`**:
    * Fetches Copilot summaries and wrap-up codes from Genesys Cloud (`/api/v2/conversations/{id}/summaries`)
    * Uses `@InvocableMethod` for trigger-based invocation and `@future(callout=true)` for async processing
    * Parses API response and maps data to Salesforce fields for both object types

### Automation Triggers
* **`ExperienceTrigger.trigger`**:
    * Triggers data fetching for `genesysps__Experience__c` records
    * After Insert: Fetches agent participant ID when `genesysps__Interaction_Id__c` is populated and `GC_agent_participant_id__c` is blank (prevents duplicates)
    * After Update: Fetches Copilot summary when `genesysps__Ended__c` transitions from null to populated, with valid interaction ID and no existing Copilot summary (prevents loops and duplicates)
* **`VoiceCallTrigger.trigger`**:
    * Triggers data fetching for `VoiceCall` records
    * After Insert: Fetches agent participant ID when `GC_Interaction_Id__c` is populated and `GC_agent_participant_id__c` is blank (prevents duplicates)
    * After Update: Fetches Copilot summary when `CallDurationInSeconds` transitions from null/0 to > 0, with valid interaction ID and no existing Copilot summary (prevents loops and duplicates)

### genesysExperienceSummary Component (for genesysps__Experience__c)
* **`genesysExperienceSummary.html`**:
    * The template file defining the LWC's structure.
    * Uses `lightning-icon` for visual elements and standard SLDS (Salesforce Lightning Design System) classes for layout.
    * Displays data dynamically using bound JavaScript properties (e.g., `{summary}`, `{wrapUp1}`).
* **`genesysExperienceSummary.js`**:
    * The client-side controller for the LWC.
    * Uses `@api recordId` to get the current record's ID.
    * Wires to `getRecord` to fetch data from `genesysps__Experience__c`.
    * Contains getters to extract field values (e.g., `get summary()`, `get wrapUp1()`).
    * Implements `getConfidenceColor` and `generateStyle` to dynamically style elements based on confidence scores.
    * Handles the `handleWrapUpClick` event to call the Apex method `updateWrapUpCode`.
    * Uses `ShowToastEvent` to display notifications.
* **`genesysExperienceSummary.css`**:
    * Contains all custom styles for the component, including card layout, icon styling, summary box appearance, confidence-based borders, and responsive adjustments.
* **`genesysExperienceSummary.js-meta.xml`**:
    * Configuration file for the LWC.
    * Sets `isExposed` to `true` and targets `lightning__RecordPage` for the `genesysps__Experience__c` object.

### genesysVoiceCallSummary Component (for VoiceCall)
* **`genesysVoiceCallSummary.html`**:
    * The template file defining the LWC's structure (similar to genesysExperienceSummary but adapted for VoiceCall).
    * Uses `lightning-icon` with "voice_call" icon for visual elements.
    * Displays data dynamically using bound JavaScript properties.
* **`genesysVoiceCallSummary.js`**:
    * The client-side controller for the LWC.
    * Uses `@api recordId` to get the current record's ID.
    * Wires to `getRecord` to fetch data from `VoiceCall`.
    * Contains getters to extract field values from VoiceCall fields.
    * Implements `getConfidenceColor` and `generateStyle` to dynamically style elements based on confidence scores.
    * Handles the `handleWrapUpClick` event to call the Apex method `updateWrapUpCode`.
    * Uses `ShowToastEvent` to display notifications.
* **`genesysVoiceCallSummary.css`**:
    * Contains all custom styles for the component (identical to genesysExperienceSummary.css).
* **`genesysVoiceCallSummary.js-meta.xml`**:
    * Configuration file for the LWC.
    * Sets `isExposed` to `true` and targets `lightning__RecordPage` for the `VoiceCall` object.

## Error Handling and Logging

* **Apex**: All Apex classes (`ExperienceCopilotController`, `VoiceCallCopilotController`, `GCGetAgentParticipantId`, `GCFetchInteractionSummary`) use comprehensive `try-catch` blocks to handle exceptions. Errors are logged using `System.debug` and re-thrown as appropriate exceptions (`AuraHandledException`, `WrapUpException`, `GCAgentException`, `GCSummaryException`) to be caught by their respective callers.
* **LWC**: Both `genesysExperienceSummary.js` and `genesysVoiceCallSummary.js` files include error handling for data loading (`wiredExperience`/`wiredVoiceCall`) and for the wrap-up update process (`handleWrapUpClick`). Errors are displayed to the user via `ShowToastEvent`.
* **Triggers**: Both `ExperienceTrigger` and `VoiceCallTrigger` include error handling to prevent trigger failures from affecting the overall transaction.
* **Debugging**: Console logs (`System.debug` in Apex, `console.log` and `console.error` in JS) are present throughout the code to aid in debugging. The `DEBUG_HEADER` constants help identify the source of log messages from different components.
